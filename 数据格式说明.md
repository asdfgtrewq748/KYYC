# STGCN 矿压预测模型 - 数据格式说明

## 📊 CSV 数据文件格式

### 格式 1: 带时间列 (推荐)

```csv
时间, 支架1, 支架2, 支架3, 支架4, ...
2023-01-01 00:00, 100.5, 98.3, 102.1, 99.8, ...
2023-01-01 01:00, 101.2, 99.1, 103.5, 100.2, ...
2023-01-01 02:00, 100.8, 98.7, 102.8, 100.5, ...
...
```

**说明:**
- 第一列为时间戳(会自动识别并移除)
- 每一列代表一个支架/监测点的压力值
- 每一行代表一个时间点的所有支架读数

### 格式 2: 不带时间列

```csv
支架1, 支架2, 支架3, 支架4, ...
100.5, 98.3, 102.1, 99.8, ...
101.2, 99.1, 103.5, 100.2, ...
100.8, 98.7, 102.8, 100.5, ...
...
```

**说明:**
- 直接是数值数据
- 每一列代表一个支架
- 每一行代表一个时间点

## 🔗 邻接矩阵 (Adjacency Matrix)

邻接矩阵描述了支架之间的空间关系。系统提供以下几种生成方式:

### 1. 链式结构 (Chain) - **推荐用于工作面支架**

```
支架1 -- 支架2 -- 支架3 -- 支架4 -- ...
```

**适用场景:** 工作面支架呈一字排列,每个支架只与相邻支架有关联

**邻接矩阵示例 (5个支架):**
```
  1  2  3  4  5
1[0  1  0  0  0]
2[1  0  1  0  0]
3[0  1  0  1  0]
4[0  0  1  0  1]
5[0  0  0  1  0]
```

### 2. 网格结构 (Grid) - 用于2D排列

```
支架1 -- 支架2 -- 支架3
  |        |        |
支架4 -- 支架5 -- 支架6
  |        |        |
支架7 -- 支架8 -- 支架9
```

**适用场景:** 支架呈网格状排列

### 3. 全连接 (Full Connected)

**适用场景:** 认为所有支架之间都有关联(适用于小规模数据)

### 4. K近邻 (KNN)

**适用场景:** 有支架的空间坐标信息,连接最近的K个支架

### 5. 自定义上传

可以上传自己的邻接矩阵文件(.npy 或 .csv 格式)

**要求:**
- 形状: (支架数, 支架数)
- 无向图: adj[i][j] = adj[j][i]
- 无自环: adj[i][i] = 0

## 📝 数据准备步骤

### 方法 1: 使用示例数据(快速测试)

1. 运行示例数据生成脚本:
   ```bash
   python generate_sample_data.py
   ```

2. 会生成以下文件:
   - `sample_mine_pressure_with_time.csv` - 带时间列的数据
   - `sample_mine_pressure_no_time.csv` - 不带时间列的数据
   - `sample_adjacency_matrix.npy` - 邻接矩阵(可选)

3. 在 Streamlit 界面上传生成的 CSV 文件

### 方法 2: 准备您自己的数据

#### 步骤 1: 准备 CSV 数据文件

**从您的监测系统导出数据,确保格式为:**

```python
import pandas as pd

# 假设您有一个 DataFrame,行是时间,列是支架
data = pd.DataFrame({
    '时间': ['2023-01-01 00:00', '2023-01-01 01:00', ...],
    '支架1': [100.5, 101.2, ...],
    '支架2': [98.3, 99.1, ...],
    # ... 更多支架
})

# 保存为 CSV
data.to_csv('my_mine_pressure.csv', index=False)
```

#### 步骤 2: 选择邻接矩阵生成方式

**如果不确定,建议选择 "链式结构"**,因为:
- 工作面支架通常呈线性排列
- 相邻支架之间的压力传递最明显
- 计算效率高

## 📊 数据要求

- **最小时间步数:** 建议 ≥ 200 (越多越好)
- **支架数量:** 建议 10-200 个
- **采样频率:** 均匀采样(如每小时一次)
- **数值范围:** 正常的压力值(如 50-200 MPa)
- **缺失值:** 需要提前处理(填充或删除)

## ⚙️ 模型参数设置建议

| 参数 | 建议值 | 说明 |
|------|--------|------|
| 历史时间步 (Seq_Len) | 12-24 | 用于预测的历史数据长度 |
| 预测时间步 (Pred_Len) | 1-3 | 预测未来几个时间步 |
| 批量大小 (Batch_Size) | 32-64 | 根据数据量调整 |
| 训练轮数 (Epochs) | 50-100 | 观察损失曲线决定 |
| 学习率 (Learning_Rate) | 0.001 | 通常不需要调整 |

## 🚀 快速开始

1. **生成示例数据:**
   ```bash
   python generate_sample_data.py
   ```

2. **启动 Streamlit 应用:**
   ```bash
   streamlit run STGCN.py
   ```
   或
   ```bash
   python -m streamlit run STGCN.py
   ```

3. **在浏览器中:**
   - 上传 CSV 文件
   - 选择邻接矩阵生成方式
   - 调整参数
   - 点击"开始训练"

## 📧 常见问题

### Q: 我的数据每列是时间,每行是支架怎么办?
**A:** 需要转置数据:
```python
df = pd.read_csv('your_data.csv')
df_transposed = df.T
df_transposed.to_csv('transposed_data.csv')
```

### Q: 数据有缺失值怎么办?
**A:** 使用插值填充:
```python
df = df.fillna(method='ffill')  # 向前填充
# 或
df = df.interpolate()  # 线性插值
```

### Q: 不知道用哪种邻接矩阵?
**A:** 默认使用"链式结构",适用于大多数工作面场景

### Q: 训练时间太长?
**A:** 
- 减少训练轮数 (Epochs)
- 减少历史时间步 (Seq_Len)
- 使用较少的数据样本
- 使用 GPU (如果可用)
